<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.40.2" />
  <meta name="author" content="Dmitry Avtonomov">

  
  
  
  
    
      
    
  
  <meta name="description" content="What is Sonatype and why is it needed? Sonatype provides a staging repository, which performs validation and allows to push the builds that pass all checks to the Central repo. Without it, basically, you can&rsquo;t easily publish anything to the Central easily, unless you&rsquo;re an Apache project or similar.
Getting started Follow their getting started guide to set up the needed credentials. This should be easy - you create a JIRA account and you create a ticket in JIRA to claim your namespace (groupId in Maven terms).">

  
  <link rel="alternate" hreflang="en-us" href="https://chhh.github.io/post/2017-01-25-publishing-to-maven-central/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-5572974-14', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="https://chhh.github.io/index.xml" type="application/rss+xml" title="Dmitry Avtonomov">
  <link rel="feed" href="https://chhh.github.io/index.xml" type="application/rss+xml" title="Dmitry Avtonomov">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://chhh.github.io/post/2017-01-25-publishing-to-maven-central/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@dmtavt">
  <meta property="twitter:creator" content="@dmtavt">
  
  <meta property="og:site_name" content="Dmitry Avtonomov">
  <meta property="og:url" content="https://chhh.github.io/post/2017-01-25-publishing-to-maven-central/">
  <meta property="og:title" content="Publishing java libraries to Maven Central | Dmitry Avtonomov">
  <meta property="og:description" content="What is Sonatype and why is it needed? Sonatype provides a staging repository, which performs validation and allows to push the builds that pass all checks to the Central repo. Without it, basically, you can&rsquo;t easily publish anything to the Central easily, unless you&rsquo;re an Apache project or similar.
Getting started Follow their getting started guide to set up the needed credentials. This should be easy - you create a JIRA account and you create a ticket in JIRA to claim your namespace (groupId in Maven terms).">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2017-01-25T00:00:00-08:00">
  
  <meta property="article:modified_time" content="2017-01-25T00:00:00-08:00">
  

  
  

  <title>Publishing java libraries to Maven Central | Dmitry Avtonomov</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Dmitry Avtonomov</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/publication">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        

        <li class="nav-item">
          <a href="/post">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Publishing java libraries to Maven Central</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2017-01-25 00:00:00 -0800 PST" itemprop="datePublished dateModified">
      2017-01-25
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dmitry Avtonomov">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    5 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Publishing%20java%20libraries%20to%20Maven%20Central&amp;url=https%3a%2f%2fchhh.github.io%2fpost%2f2017-01-25-publishing-to-maven-central%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fchhh.github.io%2fpost%2f2017-01-25-publishing-to-maven-central%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fchhh.github.io%2fpost%2f2017-01-25-publishing-to-maven-central%2f&amp;title=Publishing%20java%20libraries%20to%20Maven%20Central"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fchhh.github.io%2fpost%2f2017-01-25-publishing-to-maven-central%2f&amp;title=Publishing%20java%20libraries%20to%20Maven%20Central"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Publishing%20java%20libraries%20to%20Maven%20Central&amp;body=https%3a%2f%2fchhh.github.io%2fpost%2f2017-01-25-publishing-to-maven-central%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      

<h2 id="what-is-sonatype-and-why-is-it-needed">What is Sonatype and why is it needed?</h2>

<p>Sonatype provides a staging repository, which performs validation and allows to push the builds that pass all checks to the Central repo. Without it, basically, you can&rsquo;t easily publish anything to the Central easily, unless you&rsquo;re an Apache project or similar.</p>

<h2 id="getting-started">Getting started</h2>

<p>Follow their getting started <a href="http://central.sonatype.org/pages/ossrh-guide.html" target="_blank">guide</a> to set up the needed credentials. This should be easy - you create a JIRA account and you create a ticket in JIRA to claim your namespace (groupId in Maven terms). If you have a github account, for example, <strong><a href="http://github.com/chhh" target="_blank">http://github.com/chhh</a></strong>, you&rsquo;ll want to claim <strong>com.github.chhh</strong>.</p>

<h2 id="gpg-signing">GPG signing</h2>

<p>You&rsquo;ll need to set up and publish your GPG key for signing artifacts. This is described <a href="http://central.sonatype.org/pages/working-with-pgp-signatures.html" target="_blank">here</a>.</p>

<p>In short you&rsquo;ll need to install gpg or gpg2. I did it on Windows and already had a working gpg that came with git installation. So I happily used that to generate my key with (create it with a passphrase!):
<code>gpg --gen-key</code><br />
<strong>Make sure to check</strong> that the generated key does not have sub keys for signing. First issue <code>gpg --list-keys</code>, the output should be like:</p>

<pre><code class="language-text">$ gpg --list-keys
/c/Users/&lt;username&gt;/.gnupg/pubring.gpg
---------------------------------
pub   2048R/DA123C12 2012-01-24
uid                  Dmitry Avtonomov (chhh) &lt;email@gmail.com&gt;
sub   2048R/3E123123 2012-01-24
</code></pre>

<p>Notice, that there is one <em>pub</em> key and one <em>sub</em> key. You want this <em>sub</em> key to not be <em>Usage: C</em> type.
<code>gpg --edit-key DA123C12</code></p>

<pre><code class="language-text">gpg (GnuPG) 1.4.20; Copyright (C) 2015 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Secret key is available.

pub  2048R/DA100C23  created: 2012-01-24  expires: never       usage: SC
                     trust: ultimate      validity: ultimate
sub  2048R/3E123123  created: 2012-01-24  expires: never       usage: E
[ultimate] (1). Dmitry Avtonomov (chhh) &lt;email@gmail.com&gt;

</code></pre>

<p>In this case the <em>sub</em> key is <em>usage: E</em>, it&rsquo;s used for encryption only, so we&rsquo;re good to go, otherwise you&rsquo;d need to delete or revoke it.
Published the key with:</p>

<p><code>gpg --keyserver hkp://pool.sks-keyservers.net --send-keys &lt;key-id&gt;</code></p>

<h3 id="windows-caveat">Windows caveat</h3>

<p>The previous steps created the keychain file in <code>c:/Users/&lt;username&gt;/.gnupg</code>. However, when I later installed the native windows gpg from <a href="https://www.gnupg.org/download/" target="_blank">https://www.gnupg.org/download/</a> I&rsquo;ve found that it used a different default path and I could not list the key anymore. Addind a new environment variable <code>GNUPGHOME</code> and set it to <code>C:\Users\&lt;username&gt;\.gnupg</code>. Now the gpg that was installed in windows could read the old keychain, which meant maven could now use that key to sign files.</p>

<h2 id="configuring-maven-to-know-where-to-get-the-signing-key">Configuring Maven to know where to get the signing key</h2>

<p>Check out your <code>&lt;maven-install-apth&gt;/conf</code> directory. There should be a <code>settings.xml</code> file. Copy that over to your <code>&lt;user-home&gt;/.m2</code>, unless you already have it there. Add the following to <code>&lt;profiles&gt;</code>:</p>

<pre><code class="language-xml">&lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;ossrh&lt;/id&gt;
      &lt;activation&gt;
        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
      &lt;/activation&gt;
      &lt;properties&gt;
        &lt;gpg.executable&gt;gpg&lt;/gpg.executable&gt;
        &lt;gpg.passphrase&gt;passphrase-you-used-when-created-gpg-key&lt;/gpg.passphrase&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;
</code></pre>

<p>It&rsquo;s ok to have your passphrase set here as this is your user-specific configuration file. If you don&rsquo;t want to specify that, however, there will be an option for you to provide that passphrase every time you publish.</p>

<h2 id="configuring-maven-to-know-the-credentials-for-sonatype-servers">Configuring Maven to know the credentials for Sonatype servers</h2>

<p>You&rsquo;ll provide the log-in credentials in the same <code>settings.xml</code> maven file in <code>~/.m2</code> directory. If you don&rsquo;t want to provide the actual username and password, log in to your account at <a href="https://oss.sonatype.org" target="_blank">https://oss.sonatype.org</a>. In the top right corner click <code>Log-In</code>, then click your username and select <code>Profile</code>. On the new screen there&rsquo;s a dropdown with two choices: <em>Summary</em> and <em>User Token</em>. Select the user token, it will give you the info. In the <code>settings.xml</code> file add:</p>

<pre><code class="language-xml">  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;ossrh&lt;/id&gt;
      &lt;username&gt;user-name-token&lt;/username&gt;
      &lt;password&gt;password-for-token&lt;/password&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
</code></pre>

<h2 id="satisfying-requirements-to-pass-all-checks-upon-submission-to-sonatype">Satisfying requirements to pass all checks upon submission to Sonatype</h2>

<p>There&rsquo;s a lot of meta-info required to satisfy all the requirements. As you will be using the same <code>groupId</code> for all your artifacts, it&rsquo;s easier to put all the extra information to a parent POM. You can find an example parent project here: <a href="https://github.com/chhh/sonatype-ossrh-parent" target="_blank">https://github.com/chhh/sonatype-ossrh-parent</a>. This project consists only of the POM file, specifying the credentials, basic info and publishing locations. It adds some to the <code>release</code> target as well.
It&rsquo;s ok to just clone that repo and change the information to what you like.
<strong>You will set this POM as the <code>&lt;parent&gt;</code> of the projects you wish to publish to Central.</strong> As it will be the parent POM, anyone who will want to build your artifacts will need to have that POM, so the first thing is to publish this project to Central by itself.</p>

<h2 id="publishing-parent-pom-project-to-central">Publishing parent POM project to Central</h2>

<p>We&rsquo;ll be using maven-release plugin. Make sure that:</p>

<ul>
<li>You have SCM information configured.</li>
<li>In this parent POM you set the <code>version</code> to something like <code>0.1-SNAPSHOT</code>.</li>
</ul>

<p>The release plugin will use that information to create the build. It will remove the <code>SNAPSHOT</code> part, build the project, create a new tag in SCM, push everything to remote, bump up the version in POM and re-add SNAPSHOT back to it.
Now execute:
<code>mvn release:prepare</code>
<code>mvn release:perform</code>
If you encounter any problems with <code>release:perform</code> you can always do
<code>mvn release:rollback</code> to undo any changes done by <code>release:prepare</code>.</p>

<h2 id="publishing-the-project-to-central">Publishing the project to Central</h2>

<p>In your actual project set the <code>parent</code>:</p>

<pre><code class="language-xml">&lt;parent&gt;
    &lt;groupId&gt;com.github.chhh&lt;/groupId&gt;
    &lt;artifactId&gt;sonatype-ossrh-parent&lt;/artifactId&gt;
    &lt;version&gt;0.1&lt;/version&gt;
    &lt;relativePath&gt;../sonatype-ossrh&lt;/relativePath&gt;
&lt;/parent&gt;
</code></pre>

<p>Notice how we used <code>relativePath</code> to give maven a hint at where to search for this POM. The parent project was resiging in a sibling directory next to the project directory in this case. Otherwise the POM would have to be in the parent directory of your project.</p>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="https://chhh.github.io/tags/maven/">maven</a>
  
  <a class="btn btn-primary btn-outline" href="https://chhh.github.io/tags/sonatype/">sonatype</a>
  
</div>




    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Dmitry Avtonomov &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

